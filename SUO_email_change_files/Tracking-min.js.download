var OFSYS_Tracker2=new Object({Version:function(){return"1.00"},Data:{},InterceptionConfigs:null,ExtraStorageDataConfig:null,CurrentInterceptor:null,DebugMode:!1,TimerUpdate:null,TimerStepSecond:2,AlreadyDisplayError:!1,IsDummy:!1,CheckConsent:!0,IsFirstRequest:!1,NeedToTrack:!1,ECommerce:{Transactions:[],Carts:[],isInt:function(e){return isFinite(e)&&e%1==0},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},is:function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e},ValidateForArray:function(e,t){if(void 0===e||void 0===t||null===e||null===t)throw"validatation config is invalid";for(var i=0;i<t.length;i++){var n=t[i];this.ValidateBase(e,n),this.ValidateMembers(e,n)}},Validate:function(e,t){if(void 0===e||void 0===t||null===e||null===t)throw"validatation config is invalid";if(e.length!==t.length)throw"invalid number of arguments";for(var i=0;i<e.length;i++){var n=e[i],o=t[i];this.ValidateBase(n,o),this.ValidateMembers(n,o)}},ValidateMembers:function(e,t){if(void 0!==e.RequiredMembers&&null!==e.RequiredMembers)for(var i=0;i<e.RequiredMembers.length;i++){var n,o=e.RequiredMembers[i];if(void 0===o.Name||null==o.Name)throw"validatation config is invalid";if(o.isCaseInsensitive){if(null==(n=this.GetValueFromObject(t,o.Name))||this.is("String",n)&&""==n)throw o.Name+" is required"}else if(void 0===(n=t[o.Name])||null==n||this.is("String",n)&&""==n)throw o.Name+" is required";this.ValidateBase(o,n),this.ValidateMembers(o,n)}},ValidateBase:function(e,t){if(void 0===t||null==t)throw"invalid argument type";if(void 0!==e.Type&&null!==e.Type)if("int"===e.Type){if(!this.isNumber(t)||!this.isInt(t))throw"invalid argument type"}else if("float"===e.Type){if(!this.isNumber(t))throw"invalid argument type"}else if(!this.is(e.Type,t))throw"invalid argument type"},AddTransaction:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idTransaction"}]}],arguments),this.removeOldObjectFromArray(this.Transactions,"idTransaction",e.idTransaction),this.Transactions.push(e)},UpdateTransaction:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idTransaction"}]}],arguments),this.updateArrayFromObject(this.Transactions,"idTransaction",e.idTransaction,e)},UpdateTransactionItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idProduct"}]}],arguments);var t=this.getItemInArray(this.Transactions,"idTransaction",e.idTransaction);this.updateArrayFromObject(t.items,"idProduct",e.idProduct,e)},AddItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idTransaction"},{Name:"idProduct"}]}],arguments);var t=this.getItemInArray(this.Transactions,"idTransaction",e.idTransaction);if(null==t)throw"invalid idTransaction";void 0===t.items&&(t.items=[]),this.removeOldObjectFromArray(t.items,"idProduct",e.idProduct),t.items.push(e)},RemoveItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idTransaction"},{Name:"idProduct"}]}],arguments);var t=this.getItemInArray(this.Transactions,"idTransaction",idTransaction);if(null==t)throw"invalid idTransaction";void 0===t.items&&(t.items=[]),this.removeOldObjectFromArray(t.items,"idProduct",e.idProduct)},AddCart:function(e){return this.Validate([{Type:"Object",RequiredMembers:[{Name:"idCart"},{Name:"TotalPrice",Type:"float",isCaseInsensitive:!0}]}],arguments),this.removeOldObjectFromArray(this.Carts,"idCart",e.idCart),this.Carts.push(e),e},AddCartItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idCart"},{Name:"idProduct"},{Name:"priceunit",Type:"float",isCaseInsensitive:!0},{Name:"quantity",Type:"int",isCaseInsensitive:!0}]}],arguments);var t=this.getItemInArray(this.Carts,"idCart",e.idCart);if(null==t)throw"cannot found cart";void 0===t.items&&(t.items=[]),this.removeOldObjectFromArray(t.items,"idProduct",e.idProduct),t.items.push(e)},UpdateCartItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idProduct"}]}],arguments);var t=this.getItemInArray(this.Carts,"idCart",e.idCart);this.updateArrayFromObject(t.items,"idProduct",e.idProduct,e)},RemoveCartItem:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idCart"},{Name:"idProduct"}]}],arguments);var t=this.getItemInArray(this.Carts,"idCart",e.idCart);if(null==t)throw"invalid idCart";void 0===t.items&&(t.items=[]),this.removeOldObjectFromArray(t.items,"idProduct",e.idProduct)},UpdateCart:function(e){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idCart"}]}],arguments),this.updateArrayFromObject(this.Carts,"idCart",e.idCart,e)},ClearCart:function(){this.Carts=[]},ClearTransaction:function(){this.Transactions=[]},ProductView:function(e){if(this.is("Object",e)){this.Validate([{Type:"Object",RequiredMembers:[{Name:"idProduct"}]}],arguments);var t=this.GetValueFromObject(e,"Product"),i=null!=t,n=this.GetValueFromObject(e,"Category"),o=null!=n;if(i)if(this.Validate([{Type:"Object",RequiredMembers:[{Name:"idProduct"}]}],[t]),this.GetValueFromObject(t,"idProduct")!=this.GetValueFromObject(e,"idProduct"))throw"invalid idProduct";if(o&&this.Validate([{Type:"Object",RequiredMembers:[{Name:"idCategory"}]}],[n]),o&&i){var r=this.GetValueFromObject(t,"idCategory"),a=this.GetValueFromObject(n,"idCategory");if(null!=r&&r!=a)throw"invalid idCategory"}this.Submit("OFSYS_ECommerce_View",e)}else this.Submit("OFSYS_ECommerce_View",{idProduct:e})},SubmitCart:function(){if(void 0===this.Carts||null==this.Carts||!this.is("Array",this.Carts)||0==this.Carts.length)throw"no cart";this.ValidateForArray([{Name:"idCart",isCaseInsensitive:!0},{Name:"TotalPrice",Type:"float",isCaseInsensitive:!0},{Name:"items",Type:"Array",isCaseInsensitive:!0}],this.Carts);for(var e=[{Name:"idCart",isCaseInsensitive:!0},{Name:"idProduct",isCaseInsensitive:!0},{Name:"productName",Type:"String",isCaseInsensitive:!0},{Name:"priceunit",Type:"float",isCaseInsensitive:!0},{Name:"quantity",Type:"int",isCaseInsensitive:!0}],t=0;t<this.Carts.length;t++){var i=this.Carts[t],n=this.GetValueFromObject(i,"items");0!=n.length&&this.ValidateForArray(e,n)}this.Submit("OFSYS_ECommerce_Cart",this.Carts)},SubmitTransaction:function(){if(void 0===this.Transactions||null==this.Transactions||!this.is("Array",this.Transactions)||0==this.Transactions.length)throw"no transaction";this.ValidateForArray([{Name:"idTransaction",isCaseInsensitive:!0},{Name:"revenue",Type:"float",isCaseInsensitive:!0},{Name:"tax",Type:"float",isCaseInsensitive:!0},{Name:"shipping",Type:"float",isCaseInsensitive:!0},{Name:"items",Type:"Array",isCaseInsensitive:!0}],this.Transactions);for(var e=[{Name:"idTransaction",isCaseInsensitive:!0},{Name:"idProduct",isCaseInsensitive:!0},{Name:"productName",Type:"String",isCaseInsensitive:!0},{Name:"price_unit",Type:"float",isCaseInsensitive:!0},{Name:"quantity",Type:"int",isCaseInsensitive:!0},{Name:"price_total",Type:"float",isCaseInsensitive:!0}],t=0;t<this.Transactions.length;t++){var i=this.Transactions[t],n=this.GetValueFromObject(i,"items");if(0==n.length)throw"no items in transaction "+i.idTransaction;this.ValidateForArray(e,n)}this.Submit("OFSYS_ECommerce_Transaction",this.Transactions)},Submit:function(evtName,data){if(!OFSYS_Tracker2.IsDummy&&!(void 0===data||null==data||this.is("Array",data)&&0==data.length)){OFSYS_Tracker2.ClearEventFromData(),OFSYS_Tracker2.Set("OFSYS_E0",evtName);var url=OFSYS_Tracker2.GetTrackingURL();OFSYS_Tracker2.corsAjax({url:url,data:JSON.stringify(data),success:function(responseText){void 0!==OFSYS_Tracker2.Data.OFSYSDebugProcess&&1==OFSYS_Tracker2.Data.OFSYSDebugProcess&&eval(responseText)},error:function(e,t){void 0!==OFSYS_Tracker2.Data.OFSYSDebug&&console.log(t)}})}},GetValueFromObject:function(e,t){for(var i in e)if(i.toLowerCase()==t.toLowerCase())return e[i];return null},removeOldObjectFromArray:function(e,t,i){for(var n in e)if(this.GetValueFromObject(e[n],t)==i)return void e.splice(n,1)},updateArrayFromObject:function(e,t,i,n){var o=this.getItemInArray(e,t,i);if(null!=o)for(var r in n)o[r]=n[r]},getItemInArray:function(e,t,i){for(var n in e)if(this.GetValueFromObject(e[n],t)==i)return e[n];return null}},SetInterceptionConfigs:function(e){this.InterceptionConfigs=e},SetExtraStorageDataConfigs:function(e){this.ExtraStorageDataConfigs=e},ClearEventFromData:function(){for(var e in this.Data)0==e.indexOf("OFSYS_E")&&delete this.Data[e]},GetKeyForConsent:function(){return"OFSYS_Consent_".concat(this.Data.ClientCode)},SetConsent:function(e){if(!1!==e&&!0!==e)throw"Parameter is not a boolean";this.setCookie(this.GetKeyForConsent(),e,15),e?(this.IsFirstRequest=!1,this.NeedToTrack&&this.Track()):!1===e&&this.SupportLocalStorage()&&(localStorage.clear(),sessionStorage.clear())},IsConsented:function(){var e=this.getCookie(this.GetKeyForConsent());return""==e?!this.CheckConsent||(this.SetConsent(!0),!(this.IsFirstRequest=!0)):"true"===e&&!this.IsFirstRequest},setCookie:function(e,t,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var o="expires="+n.toUTCString();document.cookie=e+"="+t+";"+o+";path=/"},getCookie:function(e){for(var t=e+"=",i=decodeURIComponent(document.cookie).split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},Track:function(){if(!this.IsDummy)if(this.IsConsented()){if(this.NeedToTrack&&(this.NeedToTrack=!1),void 0!==this.Data.ClientCode){if(null==document.body){var e=document.createElement("body");document.body=e}if(this.Set("ScreenHeight",screen.height.toString()),this.Set("ScreenWidth",screen.width.toString()),this.Set("OFSYS_Referrer",document.referrer.substr(0,256)),!(0<arguments.length&&this.ExtraData(arguments[0].toString()))){this.ClearEventFromData();if(2==arguments.length&&arguments[1].constructor==={}.constructor)this.Set("OFSYS_E0",arguments[0].toString()),this.SetJSON(arguments[1]);else if(0<arguments.length)for(var t=0;t<arguments.length;t++)this.Set("OFSYS_E"+t,arguments[t].toString());this.setWebStorage();var i=this.QueryString();if(void 0!==i.JourneyTraces&&"1"===i.JourneyTraces&&this.Set("forTracing","1"),void 0!==i.OFSYSDebugProcess&&this.Set("OFSYSDebugProcess",i.OFSYSDebugProcess),void 0!==i.OFSYSDebug&&this.Set("OFSYSDebug",i.OFSYSDebug),void 0!==this.Data.OFSYSDebugProcess&&1==this.Data.OFSYSDebugProcess){var n=document.createElement("script");n.type="text/javascript",n.src=OFSYS_Tracker2.GetTrackingURL(),console.log("processing..."),document.body.appendChild(n)}else{var o=document.createElement("img");if(o.src=OFSYS_Tracker2.GetTrackingURL(),void 0===this.Data.OFSYSDebug&&(o.height=1,o.width=1,o.style.display="none"),void 0!==i.JourneyTraces&&"1"===i.JourneyTraces){var r="L'envoi au module Parcours s'est effectu� avec succ�s.",a=[],s=this.GetOfsysParameters();for(t=0;t<s.length;t++){"oft_campaign"!==(c=s[t])&&void 0!==this.Data[c]&&a.push(c)}for(var c in this.Data)-1!==c.indexOf("f_")&&a.push(c);if(0==a.length)r+="\\n\\nAucun identifiant n'a �t� transmis.";else{r+="\\n\\nLes identifiants suivant ont �t� transmis : ";for(t=0;t<a.length;t++){r+="\\n"+(c=a[t])+" : "+this.Data[c]}}r+="\\n\\nLe traitement de ces donn�es peut prendre quelques minutes. Une fois le traitement termin�, les r�sultats s'afficheront dans la page de diagnostique.",o.setAttribute("onload",'this.parentNode.removeChild(this); console.log("'+r+'");')}else o.setAttribute("onload","this.parentNode.removeChild(this)");document.body.appendChild(o)}if(0==window.name.indexOf("OFSYS_Test_Interceptor")){var l=document.location.protocol;this.DebugMode=!0;var d=window.name.split("_"),u=l+"//ofsys.com/T/OFC4/IST2/"+this.Data.ClientCode+"/"+d[d.length-1]+".ofsys";console.log(u);var h=this;this.corsAjax({url:u,data:null,success:function(e){var t=JSON.parse(e);if(h.CurrentInterceptor=t,"undefined"==typeof ofsysInterception){var i=l+"//t.ofsys.com/js/Tracking2/package-min.js",n=document.createElement("script");n.type="text/javascript",n.src=i,document.body.appendChild(n),n.setAttribute("onload","OFSYS_Tracker2.ShowInterceptor();")}else h.ShowInterceptor()},error:function(e,t){void 0!==h.Data.OFSYSDebug&&console.log(t)}})}else this.SupportLocalStorage()&&null!=this.InterceptionConfigs&&this.EvaluateInterceptions()}}}else this.NeedToTrack=!0},GetOfsysParameters:function(){return["oft_id","oft_k","oft_lk","oft_d","oft_c","oft_ck","oft_campaign"]},UpdateTime:function(){var e="OFSYS_Visitor_"+this.Data.ClientCode,t=localStorage.getItem(e);new Date;if(null!=t){var i=JSON.parse(t);i.CurrentVisitSecond=i.CurrentVisitSecond+this.TimerStepSecond,i.TotalSecondOpen=i.TotalSecondOpen+this.TimerStepSecond,localStorage.setItem(e,JSON.stringify(i))}},setWebStorage:function(){if(this.SupportLocalStorage()&&void 0!==this.Data.ClientCode){document.location.origin||(document.location.origin=document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:""));this.QueryString();var e=this.GetOfsysParameters(),t="OFSYS_Visit_"+this.Data.ClientCode,i="OFSYS_Visitor_"+this.Data.ClientCode,n="OFSYS_Interception_"+this.Data.ClientCode,o=localStorage.getItem(n),r=sessionStorage.getItem(t),a=localStorage.getItem(i),s={},c={};null!=r&&(s=JSON.parse(r)),null!=a&&(c=JSON.parse(a));var l=this.GetAllValuesDic();void 0===c.vKey&&(c.vKey=this.generateUniqueID());var d=null==r;if(null!=r){for(var u=0;u<e.length;u++){if(void 0!==l[h=e[u]]&&(void 0===s[h]||void 0!==s[h]&&l[h].toLowerCase()!=s[h].toLowerCase())){d=!0;break}}if(!d)for(var h in l)if(-1!=h.indexOf("f_")&&(void 0===s[h]||void 0!==s[h]&&l[h].toLowerCase()!=s[h].toLowerCase())){d=!0;break}}var p=(new Date).getTime();if((void 0===s.vKey||d)&&(s.vKey=this.generateUniqueID(),null!=o)){var f=JSON.parse(o);for(var h in f)void 0!==f[h].VisitCountSinceLastDisplay&&(f[h].VisitCountSinceLastDisplay=f[h].VisitCountSinceLastDisplay+1);localStorage.setItem(n,JSON.stringify(f))}var m=!1;for(u=0;u<e.length;u++){var C=e[u];if(void 0!==l[C]){if(s[C]=l[C],"oft_campaign"==C)continue;m=!0,void 0!==c[C]&&delete c[C]}}for(var h in l)-1!=h.indexOf("f_")&&(m=!0,s[h]=l[h],void 0!==c[h]&&delete c[h]);if(void 0!==this.Data.OFSYS_E0){var g=this.Data.OFSYS_E0;c["OFSYSEVENT_dtLastHit_"+g]=p;var v="OFSYSEVENT_countHit_"+g;void 0===c[v]?(c[v]=1,c["OFSYSEVENT_dtFirstHit_"+g]=p):c[v]=c[v]+1}void 0!==c.VisitCount&&d?c.VisitCount=c.VisitCount+1:!d&&void 0!==c.VisitCount||(c.VisitCount=1),void 0===c.dtFirstVisit?c.dtFirstVisit=p:void 0!==c.dtLastVisit&&d&&(c.dtPreviousVisit=c.dtLastVisit),d||void 0===c.openedPageCount?(c.openedPageCount=1,c.lastOpenedPage=document.location.origin+document.location.pathname):void 0!==c.openedPageCount&&void 0!==c.openedPageCount&&c.lastOpenedPage!=document.location.origin+document.location.pathname&&(c.openedPageCount=c.openedPageCount+1),d||void 0===c.openedPageCount||(c.lastOpenedPage=document.location.origin+document.location.pathname),!d&&void 0!==c.dtLastVisit||(c.dtLastVisit=p),void 0!==c.HitCount?c.HitCount=c.HitCount+1:c.HitCount=1,d||void 0===c.HitCurrentVisit?c.HitCurrentVisit=1:void 0!==c.HitCurrentVisit&&(c.HitCurrentVisit=c.HitCurrentVisit+1),c.TotalVisitSecond=this.getDiffSeconds(new Date(c.dtFirstVisit),new Date(p)),void 0===c.TotalSecondOpen&&(c.TotalSecondOpen=0),d||void 0===c.CurrentVisitSecond?c.CurrentVisitSecond=0:void 0!==c.dtLastVisit&&(c.CurrentVisitSecond=this.getDiffSeconds(new Date(c.dtLastVisit),new Date(p))),c.dtLastHit=p,m?c.IsIdentified=!0:void 0===c.IsIdentified&&(c.IsIdentified=!1),sessionStorage.setItem(t,JSON.stringify(s)),localStorage.setItem(i,JSON.stringify(c));if(-1==window.name.indexOf("OFSYS_Test_Interceptor")&&null==this.TimerUpdate){var S=this;this.TimerUpdate=setInterval(function(){try{if(S.UpdateTime(),null!==S.InterceptionConfigs)for(var e=0;e<S.InterceptionConfigs.length;e++)if(null===S.CurrentInterceptor&&null!==S.InterceptionConfigs[e].Config&&(null!==S.InterceptionConfigs[e].Config.Timing||null!==S.InterceptionConfigs[e].Config.EventConditions)){S.EvaluateInterceptions();break}}catch(e){S.AlreadyDisplayError||(S.AlreadyDisplayError=!0,console.log(e))}},1e3*S.TimerStepSecond)}}},getDiffSeconds:function(e,t){var i=Math.abs(t.getTime()-e.getTime());return Math.ceil(i/1e3)},addDays:function(e,t){var i=new Date(e);return i.setDate(i.getDate()+t),i},generateUniqueID:function(){return"xxxxxxxx".replace(/[x]/g,function(e){return"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(62*Math.random()))})},QueryString:function(){for(var e={},t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var n=t[i].split("=");if(void 0===e[n[0]])e[n[0]]=n[1];else if("string"==typeof e[n[0]]){var o=[e[n[0]],n[1]];e[n[0]]=o}else e[n[0]].push(n[1])}return e},GetTrackingURL:function(){if(void 0===this.Data.ClientCode)return"";var e="",t=0;for(var i in this.Data)"ClientCode"!=i&&(0<t&&(e+="("),e+=this.Base64_Encode(i)+")"+this.Base64_Encode(this.Data[i]),t++);if(this.SupportLocalStorage()){void 0!==localStorage["OFSYS_Visitor_"+this.Data.ClientCode]&&void 0!==sessionStorage["OFSYS_Visit_"+this.Data.ClientCode]||this.setWebStorage();var n=JSON.parse(localStorage["OFSYS_Visitor_"+this.Data.ClientCode]),o=JSON.parse(sessionStorage["OFSYS_Visit_"+this.Data.ClientCode]);void 0!==n.vKey&&(e+="(",e+=this.Base64_Encode("visitorKey")+")"+this.Base64_Encode(String(n.vKey))),void 0!==o.vKey&&(e+="(",e+=this.Base64_Encode("visitKey")+")"+this.Base64_Encode(String(o.vKey)))}else e+="(",e+=this.Base64_Encode("lstorage")+")"+this.Base64_Encode("0");var r=document.location.protocol+"//t.ofsys.com/C/"+this.Data.ClientCode+"/"+this.Version()+"/"+this.CRC32(e)+"/journey.gif?cache="+(new Date).getTime();return 0<e.length&&(r+="&d="+encodeURIComponent(e)),r},GetAllValuesDic:function(){for(var e=this.GetOfsysParameters(),t={},i=this.QueryString(),n=0;n<e.length;n++)void 0!==i[e[n]]&&(t[e[n]]=i[e[n]]);for(var o in this.Data)"ClientCode"!=o&&(t[o]=this.Data[o]);return t},SupportLocalStorage:function(){var e="ofsys_test";try{localStorage.setItem(e,e);var t=localStorage[e]==e;return localStorage.removeItem(e),t}catch(e){return!1}},EvaluateInterceptions:function(){if(!this.SupportLocalStorage()||void 0===this.Data.ClientCode||null==this.InterceptionConfigs)return!1;for(var e="OFSYS_Interception_"+this.Data.ClientCode,t=localStorage.getItem(e),i="OFSYS_Visitor_"+this.Data.ClientCode,n=localStorage.getItem(i),o=JSON.parse(n),r=new Date,a=null,s=[],c=0,l=1,d=2,u=3,h=4,p=0;p<this.InterceptionConfigs.length;p++){var f=this.InterceptionConfigs[p].Config;if(null==a||2===f.InterceptionType){if(document.location.origin||(document.location.origin=document.location.protocol+"//"+document.location.hostname+(document.location.port?":"+document.location.port:"")),f.displayEveryWhere){if(this.ValidateAddress(document.location.origin+document.location.pathname,f.Address))continue}else if(!this.ValidateAddress(document.location.origin+document.location.pathname,f.Address))continue;if(null!=f.Timing){if(null!=f.Timing.AfterNbOpenedPages&&o.openedPageCount<f.Timing.AfterNbOpenedPages)continue;if(f.Timing.AfterNbSecondsVisit&&o.CurrentVisitSecond<f.Timing.AfterNbSecondsVisit)continue}var m=null;if(null!=t){var C=JSON.parse(t);void 0!==C[this.InterceptionConfigs[p].idInterceptor]&&(m=C[this.InterceptionConfigs[p].idInterceptor])}if(null!=f.Recurrence){if(null!=f.Recurrence.DisplayOnlyOneTime&&f.Recurrence.DisplayOnlyOneTime&&null!=m&&1<=m.DisplayInterceptorTotalCount)continue;if(f.Recurrence.NbDisplaysByPeriod&&null!=m)if(f.Recurrence.PeriodType==h){if(void 0!==m.VisitCountSinceLastDisplay&&f.Recurrence.NbDisplaysByPeriod>m.VisitCountSinceLastDisplay)continue}else{var g=new Date(m.dtDisplay[m.dtDisplay.length-1]),v=new Date(r);if(f.Recurrence.PeriodType==c?v.setDate(r.getDate()-f.Recurrence.NbDisplaysByPeriod):f.Recurrence.PeriodType==l?v.setDate(r.getDate()-7*f.Recurrence.NbDisplaysByPeriod):f.Recurrence.PeriodType==d?v.setMonth(r.getMonth()-f.Recurrence.NbDisplaysByPeriod):f.Recurrence.PeriodType==u&&v.setYear(r.getFullYear()-f.Recurrence.NbDisplaysByPeriod),v<=g)continue}}if(null!=f.DataCondition){var S=o.IsIdentified;if(!f.DataCondition.AllowKnownVisitorInterception&&S)continue;if(!f.DataCondition.AllowAnonymousInterception&&!S)continue}if(this.InterceptionConfigs[p].useAdvancedMode){if(null!=f.Timing){if(null!=f.Timing.AfterNbVisits&&o.VisitCount<f.Timing.AfterNbVisits)continue;if(null!=f.Timing.AfterNbSecondsVisit&&o.CurrentVisitSecond<f.Timing.AfterNbSecondsVisit)continue;if(null!=f.Timing.AfterNbSeconds&&o.TotalVisitSecond<f.Timing.AfterNbSeconds)continue;if(null!=f.Timing.NbDaysSinceFirstVisit&&this.addDays(new Date(o.dtFirstVisit),f.Timing.NbDaysSinceFirstVisit)>r)continue;if(null!=f.Timing.NbDaysSinceLastVisit&&this.addDays(new Date(o.dtLastVisit),f.Timing.NbDaysSinceLastVisit)>r)continue}if(null!=f.EventConditions){var y;if(null!=f.EventConditions.NbEventTimes)if(void 0===(y=o["OFSYSEVENT_countHit_"+f.EventConditions.NbEventTimesEventName])||y<f.EventConditions.NbEventTimes)continue;if(null!=f.EventConditions.NbEventNeverOccurred&&void 0!==o["OFSYSEVENT_dtLastHit_"+f.EventConditions.NbEventNeverOccurred])continue;if(null!=f.EventConditions.NbSecondsAfterFirstEvent)if(void 0===(y=o["OFSYSEVENT_dtFirstHit_"+f.EventConditions.NbSecondsAfterFirstEventName])||this.getDiffSeconds(new Date(y),r)<f.EventConditions.NbSecondsAfterFirstEvent)continue;if(null!=f.EventConditions.NbSecondsAfterLastEvent)if(void 0===(y=o["OFSYSEVENT_dtLastHit_"+f.EventConditions.NbSecondsAfterLastEventName])||this.getDiffSeconds(new Date(y),r)<f.EventConditions.NbSecondsAfterLastEvent)continue}2!==f.InterceptionType?a=this.InterceptionConfigs[p]:s.push(this.InterceptionConfigs[p])}else 2!==f.InterceptionType?a=this.InterceptionConfigs[p]:s.push(this.InterceptionConfigs[p])}}null!=a&&null!=a.Config.Timing&&void 0!==a.Config.Timing.BeforeLeavingThePage&&null!=a.Config.Timing.BeforeLeavingThePage&&!0===a.Config.Timing.BeforeLeavingThePage?setTimeout(function(){var e,t,i,n=function(e){var t=(e=e||window.event).relatedTarget||e.toElement;if("input"!=e.target.tagName.toLowerCase()){var i=Math.max(document.documentElement.clientWidth,window.innerWidth||0);e.clientX>=i-50||50<=e.clientY||t&&"HTML"!=t.nodeName||null==DI.Journey.CurrentInterceptor&&(this.removeEventListener?this.removeEventListener("mouseout",n):this.detachEvent&&this.detachEvent("onmouseout",n),DI.Journey.UpdateInterceptionLocalStorage(a),DI.Journey.Intercept(a))}};e=document,t="mouseout",i=n,e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},0):null!=a&&null==this.CurrentInterceptor&&(this.UpdateInterceptionLocalStorage(a),this.Intercept(a));for(p=0;p<s.length;p++)this.UpdateInterceptionLocalStorage(s[p]),this.Trigger(s[p])},Trigger:function(trigger){var ofsysParameters=this.GetOfsysParameters(),visitStorageKey="OFSYS_Visit_"+this.Data.ClientCode,visit=sessionStorage.getItem(visitStorageKey),visitValue={};null!=visit&&(visitValue=JSON.parse(visit));var allValuesDic=this.GetAllValuesDic();for(var key in visitValue)if(void 0===allValuesDic[key]&&"oft_campaign"!==key.toLowerCase()){for(var isOfsysParameter=!1,i=0;i<ofsysParameters.length;i++){var pName=ofsysParameters[i];if(pName.toLowerCase()===key.toLowerCase()){isOfsysParameter=!0;break}}-1===key.toLowerCase().indexOf("f_")&&!isOfsysParameter||this.Set(key,visitValue[key])}var url=this.GetTrackingURL()+"&ofsystrigger=1",that=this;this.corsAjax({url:url,data:JSON.stringify({Type:"Trigger",idInterceptor:trigger.idInterceptor}),success:function(responseText){void 0!==that.Data.OFSYSDebugProcess&&1==that.Data.OFSYSDebugProcess&&eval(responseText)},error:function(e,t){void 0!==that.Data.OFSYSDebug&&console.log(t)}})},ValidateAddress:function(e,t){if(void 0===t||null==t||0==t.length)return!1;for(var i=0;i<t.length;i++)if("*"==t[i])return!0;for(i=0;i<t.length;i++){if(new RegExp("^"+t[i].replace(new RegExp("\\*","g"),".*")+"$","i").test(e))return!0}return!1},corsAjax:function(t){try{var e=new XMLHttpRequest,i="withCredentials"in e;if(null!=window.XDomainRequest&&!i){var n=new XDomainRequest;n.open("POST",t.url),n.ontimeout=function(){t.error(408,"timeout")},n.onerror=function(){t.error(500,"error")},n.onload=function(){t.success(n.responseText)},setTimeout(function(){n.send(t.data)},0)}else e.open("POST",t.url,!0),e.setRequestHeader("Content-type","contentType"in t?t.contentType:"text/plain"),e.onreadystatechange=function(){4==e.readyState&&(200==e.status?t.success(e.responseText):t.error(e.status,e.responseText))},e.send(t.data)}catch(e){t.error(500,"exception "+e),window.console&&console.error(e)}},ExtraData:function(evt){if(!this.SupportLocalStorage()||void 0===this.Data.ClientCode||null==this.ExtraStorageDataConfigs||void 0===this.ExtraStorageDataConfigs[evt])return!1;var mappings=this.ExtraStorageDataConfigs[evt],ExtraStorageName="OFSYS_Extra_"+this.Data.ClientCode+"_"+evt,extraCookieValues=null!=localStorage.getItem(ExtraStorageName)?JSON.parse(localStorage[ExtraStorageName]):null,now=(new Date).getTime();null==extraCookieValues?(extraCookieValues={},extraCookieValues.dtFirstHit=now,extraCookieValues.dtLastHit=now,extraCookieValues.vkeyVisitor=JSON.parse(localStorage.getItem("OFSYS_Visitor_"+this.Data.ClientCode)).vKey,extraCookieValues.totalHit=1):(extraCookieValues.dtLastHit=now,extraCookieValues.totalHit=extraCookieValues.totalHit+1);for(var CookieEventMappingType={Variable:1,Counter:2,DateTime:3},allValues=this.GetAllValuesDic(),i=0;i<mappings.length;i++){var stem=mappings[i];if(stem.MappingType==CookieEventMappingType.Counter){var count,incrementCounter=!1;if(null==stem.Condition||""==stem.Condition)incrementCounter=!0;else if(stem.isConditionExpression||void 0===allValues[stem.Condition])try{incrementCounter=eval(stem.Condition)}catch(e){incrementCounter=!1}else incrementCounter=!0;incrementCounter&&(void 0!==extraCookieValues[stem.Code]?extraCookieValues[stem.Code]=extraCookieValues[stem.Code]+1:extraCookieValues[stem.Code]=1)}else if(stem.MappingType==CookieEventMappingType.Variable){var updateValue=!1;if(null==stem.Condition||""==stem.Condition)updateValue=!0;else if(stem.isConditionExpression||void 0===allValues[stem.Condition]||null==allValues[stem.Condition]||""==allValues[stem.Condition]){if(stem.isConditionExpression)try{updateValue=eval(stem.Condition)}catch(e){updateValue=!1}}else updateValue=!0;if(updateValue)if(null!=stem.Value&&""!=stem.Value&&stem.isValueExpression)try{extraCookieValues[stem.Code]=eval(stem.Value)}catch(e){}else null!=stem.Value&&""!=stem.Value&&(extraCookieValues[stem.Code]=stem.Value)}else if(stem.MappingType==CookieEventMappingType.DateTime){var updateDate=!1;if(null==stem.Condition||""==stem.Condition)updateDate=!0;else if(stem.isConditionExpression||void 0===allValues[stem.Condition])try{updateDate=eval(stem.Condition)}catch(e){updateDate=!1}else updateDate=!0;updateDate&&(extraCookieValues[stem.Code]=now)}}return localStorage.setItem(ExtraStorageName,JSON.stringify(extraCookieValues)),!0},SetJSON:function(e){if(e.constructor!={}.constructor)throw"invalid object";var t=JSON.stringify(e);e=JSON.parse(t);for(var i in e)this.Set(i,e[i])},Set:function(e,t){null!=t&&void 0!==t&&void 0!==e&&0<e.length&"_"!=e[0]&&(this.Data[e]="string"==typeof t?t:t.toString())},Base64_Encode:function(e){var t,i,n,o,r,a,s="",c=0,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=this.UTF8_Encode(e);c<e.length;)o=(3&(t=e.charCodeAt(c++)))<<4|(i=e.charCodeAt(c++))>>4,r=(15&i)<<2|(n=e.charCodeAt(c++))>>6,a=63&n,s=s+l.charAt(t>>2)+l.charAt(o),isNaN(i)||(s+=l.charAt(r)),isNaN(n)||(s+=l.charAt(a));return s},UTF8_Encode:function(e){var t="",i=new String(e);i=i.replace(/\r\n/g,"\n");for(var n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t},CRC32:function(e){for(var t=this.CRC32_Table(),i=4294967295,n=e.length,o=0;o<n;o++)(i=i>>>8^t[255&i^e.charCodeAt(o)])<0&&(i+=Math.pow(2,32));return(i^=4294967295)<0&&(i+=Math.pow(2,32)),i},CRC32_Table:function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)1&e?e=e>>>1^3988292384:e>>>=1;t[i]=e}return t},SetClientCode:function(e){this.Set("ClientCode",e)},UpdateInterceptionLocalStorage:function(e){var t=e.idInterceptor,i="OFSYS_Interception_"+this.Data.ClientCode,n=localStorage.getItem(i),o={},r=(new Date).getTime();if(null!=n&&(o=JSON.parse(n)),void 0===o[t]){var a={DisplayInterceptorTotalCount:1,VisitCountSinceLastDisplay:0,dtDisplay:[]};a.dtDisplay.push(r),o[t]=a}else o[t].dtDisplay.push(r),200<o[t].dtDisplay&&o[t].dtDisplay.splice(0,1),o[t].DisplayInterceptorTotalCount=o[t].DisplayInterceptorTotalCount+1,o[t].VisitCountSinceLastDisplay=0;localStorage.setItem(i,JSON.stringify(o))},Intercept:function(e){this.CurrentInterceptor=e,this.ShowInterceptor()},GetInterceptorContent:function(e){if(void 0!==this.Data.ClientCode){var t=document.location.protocol+"//t.ofsys.com/js/Journey/1/"+this.Data.ClientCode+"/"+e.idInterceptor+"/interceptorcontent.js",i=document.createElement("script");i.type="text/javascript",i.src=t,document.body.appendChild(i)}},ShowInterceptor:function(){var e,t=1===this.CurrentInterceptor.Config.InterceptionType,i=this.CurrentInterceptor.Content;if(void 0!==i||t){if(t){var n="https:";void 0!==this.Data.OFSYSDebug&&(n=document.location.protocol);var o=this.CurrentInterceptor.Config.DirectFormConfig.strParam+"?DI_Intercept=1",r=null,a=null;if(null!=this.CurrentInterceptor.Config.DirectFormConfig.height){r=this.CurrentInterceptor.Config.DirectFormConfig.height;var s=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-130;r<s?a=r:s<=r&&(a=s)}e=ofsysInterception.dom.create("iframe",{style:"border: 0px none;width:100%;height:calc(100% - 5px);",src:n+"//ofsys.com"+o}),this.CurrentInterceptor.iframe=e,this.CurrentInterceptor.height=a}if(void 0!==window.OFSYS_Tracking_ShowInterceptor){var c=document.createElement("div",{style:{overflow:"auto"}});null!=this.CurrentInterceptor.height&&c.setStyle("height",this.CurrentInterceptor.height+"px"),t?ofsysInterception.dom.wrap(c).append(e):c.insertAdjacentHTML("beforeEnd",i),OFSYS_Tracking_ShowInterceptor(c)}else{var l=this.CreateInterceptorPopupDiv(t);null!=this.CurrentInterceptor.height&&l.setStyle("height",this.CurrentInterceptor.height+"px"),t?(l.append(e),ofsysInterception.dom.on(e.elem,"load",this.ShowPopupDirectForm)):(l.append(ofsysInterception.dom.parse("<div>"+i+"</div>")),this.ShowPopup())}this.DisplayInterception()}else this.GetInterceptorContent(this.CurrentInterceptor)},ShowPopupDirectForm:function(){this.removeEventListener?this.removeEventListener("load",OFSYS_Tracker2.ShowPopupDirectForm):this.detachEvent&&this.detachEvent("onload",OFSYS_Tracker2.ShowPopupDirectForm),OFSYS_Tracker2.ShowPopup()},ShowPopup:function(){var e,t=document.activeElement,i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;i<(e=1===OFSYS_Tracker2.CurrentInterceptor.Config.InterceptionType&&null!=OFSYS_Tracker2.CurrentInterceptor.Config.DirectFormConfig.width?OFSYS_Tracker2.CurrentInterceptor.Config.DirectFormConfig.width:650)+90&&(e<i?e-=55:e=i-70),ofsysInterception.lightbox.ShowDivInLightbox("OFSYS_Interceptor_Popup",{WrappingClass:"Interceptor",width:e,hideCallback:function(){DI.Journey.CurrentInterceptor.isClose=!0,t.focus(),DI.Journey.CloseInterception()}}),this.CurrentInterceptor.isClose=!1;var n=ofsysInterception.dom.select1(".Interceptor .DialogInsightLightBox"),o=void 0!==this.CurrentInterceptor.iframe;n.setAttr("role","dialog"),o?-1!==this.CurrentInterceptor.iframe.elem.src.toLowerCase().indexOf("fr-ca")?n.setAttr("aria-label","Formulaire d'abonnement"):n.setAttr("aria-label","Optin form"):n.setAttr("aria-label","Invitation"),n.setAttr("tabindex","-1"),n.focus();var r=n.find1(".DialogInsightLightBoxCloseButton");r.setAttr("aria-label","Close"),r.setAttr("tabindex","0"),ofsysInterception.dom.on(r.elem,"keydown",function(e){if(!DI.Journey.CurrentInterceptorIsClose()){var t=e||window.event,i=t.which||t.keyCode;9===i&&(ofsysInterception.dom.util.cancelEvent(t),n.focus()),13===i&&ofsysInterception.dom.wrap(this).trigger("click")}}),ofsysInterception.dom.on(n.elem,"keydown",function(e){if(!DI.Journey.CurrentInterceptorIsClose()){var t=e||window.event;27===(t.which||t.keyCode)&&r.trigger("click")}})},CurrentInterceptorIsClose:function(){return void 0===this.CurrentInterceptor||null==this.CurrentInterceptor||void 0===this.CurrentInterceptor.isClose||this.CurrentInterceptor.isClose},ClosePopup:function(){DI.Journey.CurrentInterceptorIsClose()||ofsysInterception.dom.select1(".Interceptor .DialogInsightLightBox").find1(".DialogInsightLightBoxCloseButton").trigger("click")},ClosePopupIFrame:function(){void 0!==this.CurrentInterceptor.iframe&&DI.Journey.ClosePopup()},ResizeIFrame:function(e){if(null!=this.CurrentInterceptor&&void 0!==this.CurrentInterceptor.iframe&&(1!==this.CurrentInterceptor.Config.InterceptionType||null==this.CurrentInterceptor.Config.DirectFormConfig.height)){var t=e,i=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-130,n=null;void 0!==this.CurrentInterceptor.height&&(n=this.CurrentInterceptor.height),i<e&&(t=i),(null==n||n<t)&&(this.CurrentInterceptor.height=t,this.CurrentInterceptor.iframe.parent().setStyle("height",t+"px"))}},SendInterceptionEvent:function(evtName){if(!this.DebugMode&&null!=this.CurrentInterceptor){this.ClearEventFromData(),this.Set("OFSYS_E0",evtName),this.Set("OFSYS_E1",this.CurrentInterceptor.idInterceptor);var url=this.GetTrackingURL(),that=this;this.corsAjax({url:url,data:"Interception",success:function(responseText){void 0!==that.Data.OFSYSDebugProcess&&1==that.Data.OFSYSDebugProcess&&eval(responseText)},error:function(e,t){void 0!==that.Data.OFSYSDebug&&console.log(t)}})}},CloseInterception:function(){this.SendInterceptionEvent("OFSYS_CloseInterception")},DisplayInterception:function(){this.SendInterceptionEvent("OFSYS_DisplayInterception")},AcceptInterception:function(e){null!=this.CurrentInterceptor&&(this.DebugMode||this.SendInterceptionEvent("OFSYS_AcceptInterception"),void 0!==e&&null!=e&&e.call(this))},SuccessfulInterception:function(){this.SendInterceptionEvent("OFSYS_SuccessInterception")},CreateInterceptorPopupDiv:function(e){var t=document.getElementById("OFSYS_Interceptor_Popup");return null!=t&&(t.innerHTML=""),null==t?(t=ofsysInterception.dom.create("div",{id:"OFSYS_Interceptor_Popup",style:{display:"none","padding-right":"15px"}}),e&&(t.setStyle("overflow","auto"),t.setStyle("-webkit-overflow-scrolling","touch")),ofsysInterception.dom.body().append(t)):t=ofsysInterception.dom.wrap(t),t},OFSYSInterceptionAction:function(){this.AcceptInterception(this.OFSYSInterceptionActionCallBack)},OFSYSInterceptionActionCallBack:function(){0==this.CurrentInterceptor.Config.InterceptionType&&(3==this.CurrentInterceptor.Config.ActionConfig.ActionType?location.href=this.CurrentInterceptor.Config.ActionConfig.strParam:window.open(this.CurrentInterceptor.Config.ActionConfig.strParam,"_blank","height=800,width=800"))},MessageReception:function(e){if(void 0!==e&&null!=e){var t=e;if(e.constructor==="".constructor)try{t=JSON.parse(e)}catch(e){return}if(void 0!==t.data&&null!=t.data){var i=""+t.data;if("di:"==i.substr(0,3)){var n=JSON.parse(i.substr(3));void 0!==n.height&&null!==n.height&&DI.Journey.ResizeIFrame(n.height),void 0!==n.event&&"optinSuccess"===n.event?DI.Journey.SuccessfulInterception():void 0!==n.event&&"validationSuccess"===n.event?DI.Journey.AcceptInterception():void 0!==n.event&&"keydown_esc"===n.event&&DI.Journey.ClosePopupIFrame()}}}}});if("undefined"==typeof DI&&(DI={}),void 0===DI.Journey&&(DI.Journey=OFSYS_Tracker2),DI.Journey.Set("OFSYS_CurrentURL",location.href),window.addEventListener?window.addEventListener("message",DI.Journey.MessageReception,!1):window.attachEvent("onmessage",DI.Journey.MessageReception),"HeyJourney"==window.name)try{window.parent.postMessage("di:"+JSON.stringify({event:"HelloFromJourney"}),"*")}catch(e){console.error(e,"Postmessage failed")}function OFSYS_Tracking2_PluginLoadEvent(e){if("complete"===document.readyState)return setTimeout(e,1);var i=!1;function n(){i||(i=!0,e())}if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1);else if(document.attachEvent){try{var t=null!=window.frameElement}catch(e){}if(document.documentElement.doScroll&&!t){!function t(){if(!i)try{document.documentElement.doScroll("left"),n()}catch(e){setTimeout(t,10)}}()}document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()})}if(window.addEventListener)window.addEventListener("load",n,!1);else if(window.attachEvent)window.attachEvent("onload",n);else{var o=window.onload;window.onload=function(){o&&o(),n()}}}OFSYS_Tracking2_PluginLoadEvent(function(){"HeyJourney"!=window.name&&(void 0!==window.OFSYS_Tracking_onload?window.OFSYS_Tracking_onload():OFSYS_Tracker2.Track(),"undefined"!=typeof OFSYS_WebPerso&&OFSYS_WebPerso.main())});OFSYS_Tracker2.SetClientCode('$QAAAExCbkxVZPcYAAA0V0tiaEQzAAAA');OFSYS_Tracker2.CheckConsent = false;